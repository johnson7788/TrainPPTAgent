# 创建本地的网络的方法
services:
  personaldb:
    container_name: ppt_personal_db
    build:
      context: ./backend/personaldb
      dockerfile: Dockerfile
    ports:
      - "9200:9200"
    networks:
      - main_ppt_network
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"

  outline_api:
    container_name: ppt_outline_api_app
    build:
      context: ./backend/simpleOutline
      dockerfile: Dockerfile
    ports:
      - "10060:10001"
    networks:
      - main_ppt_network
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - OUTLINE_API=http://ppt_outline_api_app:10001
    command: >
      python main_api.py
      --host 0.0.0.0
      --port 10001
      --agent_url http://ppt_outline_api_app:10001/
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://localhost:10001/.well-known/agent.json"]
      interval: 10s
      timeout: 3s
      retries: 5
      start_period: 30s

  content_api:
    container_name: ppt_content_api_app
    build:
      context: ./backend/slide_agent
      dockerfile: Dockerfile
    ports:
      - "10061:10011"
    networks:
      - main_ppt_network
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - CONTENT_API=http://ppt_content_api_app:10011
    command: >
      python main_api.py
      --host 0.0.0.0
      --port 10011
      --agent_url http://ppt_content_api_app:10011/
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://localhost:10011/.well-known/agent.json"]
      interval: 10s
      timeout: 3s
      retries: 5
      start_period: 30s

  main_api:
    container_name: ppt_main_api_app
    build:
      context: ./backend/main_api
      dockerfile: Dockerfile
    ports:
      - "6800:6800"
    networks:
      - main_ppt_network
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - OUTLINE_API=http://ppt_outline_api_app:10001
      - CONTENT_API=http://ppt_content_api_app:10011
      - PERSONAL_DB=http://ppt_personal_db:9200
    depends_on:
      outline_api:
        condition: service_healthy
      content_api:
        condition: service_healthy
      personaldb:
        condition: service_started

  frontend:
    container_name: ppt_frontend
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "8008:80"
    networks:
      - main_ppt_network
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - main_api

networks:
  main_ppt_network:
    name: trainpptagent-main_ppt_network
    driver: bridge



